<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IM STUCK</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>    
    <div class="keys">
        <img id="img" src="hit1.jpg"/>
        <div data-key="32" class="key">
            <br/>
            <span class="sound score-box">hit score: <span id="hit-score"></span></span>
        </div>
        <br/>
        <p id="textbox" style="text-align: center;">Press space bar when you feel frustrated.</p>
        <div style="margin: auto; display:flex; justify-content: center;">
            <button id="throwaway" style="display: none; text-align:center; width:14%; background-color: black; color: white; " onclick="throwAway()"></button>
        </div>
    </div>
    <audio data-key="32" src="slap.wav"></audio>
    <audio id="myAudio">
        <source src="shatter.wav" type="audio/wav">
        Your browser does not support the audio element.
      </audio>


<script>
score = 0; 
document.getElementById('hit-score').innerHTML = score;  
var shatterSound = document.getElementById("myAudio");

function playSound(e) {
    // console.log(e.keyCode);
    const audio = document.querySelector(`audio[data-key="${e.keyCode}"]`);
    console.log(audio);
    if(!audio) return; //stop function from running

    audio.currentTime = 0; //rewind to the start

    audio.play();

    // animation
    const key = document.querySelector(`.key[data-key="${e.keyCode}"]`);
    console.log(key);
    key.classList.add('playing');
};


function removeTransition(e) {
    // console.log(e)
    if (e.propertyName!=='transform') return; //skip if its not transformed
    // console.log(e.propertyName)
    // after the transition time, we want to reverse everything (this = key)
    this.classList.remove('playing');
}

function changeImage() {
    document.getElementById("img").src = "hit2.jpg";
    setTimeout (function(){ document.getElementById("img").src = "hit1.jpg" }, 200);
}

function throwAway() {
    shatterSound.currentTime = 600;
    document.getElementById("throwaway").style.display = "none";    
    setTimeout (function(){ document.getElementById("img").src = "hit3.jpg" }, 300);
    setTimeout (function(){ document.getElementById("img").src = "hit4.jpg" }, 500);
    setTimeout (function(){ document.getElementById("img").src = "hit5.jpg" }, 800);
    setTimeout (function(){ shatterSound.play()}, 600);
    setTimeout (function(){ document.getElementById('textbox').innerHTML = "Press space bar to continue." }, 900);
    // setTimeout (function(){ document.getElementById("img").src = "hit6.jpg"  }, 1000);
    console.log("test")
}

document.body.onkeyup = function(e){
    if(e.keyCode == 32){
        changeImage();
        score+=1
        document.getElementById('hit-score').innerHTML = score;
        if (score>4) {
            document.getElementById('textbox').innerHTML = "Ain't life hard?";
        }
        if (score>9) {
            document.getElementById('textbox').innerHTML = "Uhh... are you ok?";
        }
        if (score>14) {
            document.getElementById('textbox').innerHTML = "I think it's time for you to take a break.";
        }
        if (score>19) {
            document.getElementById('textbox').innerHTML = "I know this sucks but you'll get out of it and feel so much better instantly.";
        }  
        if (score>24) {
            document.getElementById('textbox').innerHTML = "Alright, let's throw away the computer.";
            document.getElementById("throwaway").style.display = "block";    
            document.getElementById('throwaway').innerHTML = "DESTROY COMPUTER"
        }  
    }
}

// transition end event
const keys = document.querySelectorAll('.key');
keys.forEach(key => key.addEventListener('transitionend', removeTransition));

window.addEventListener('keydown', playSound);




</script>

</body>


</html>